!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],r):r(n.V={},n.I,n.L)}(this,function(n,r,t){"use strict";function e(n){this.value=void 0!==n?n:null}function u(n){var r=Error(JSON.stringify(n,null,2));return r.errors=n,r}function i(n){throw u(n)}function o(n,r){var t=C;return t===A?t=r:C=A,n.of(b(t))}var c=function(n){return n.length},f=r.curry(function(n,r){return n<=r}),a=r.curry(function(n,r){return r instanceof n}),s=a(Object),l=r.curry(function(n,r){return function(t){return n(r(t))}}),y=r.curry(function(n,r){return function(t){return n(t)&&r(t)}}),d=Promise,p=d.reject.bind(d),v=d.resolve.bind(d),h=function(n,t){return null!=t&&r.isFunction(t.then)?t.then(n):n(t)},m=r.id({map:h,ap:function(n,r){return h(function(r){return h(function(n){return n(r)},n)},r)},of:r.id,chain:h}),A={},w=function(n){return n===A?void 0:n},g=function(n){return void 0!==n?n:A},j=t.rewrite(function(n){var r=F(n);return r&&(n=N(n)),n=n.map(w),r?b(n):n}),O=function(n,r,t,e){return t.map(g,e(n,r))},F=a(e),b=r.id(function(n){return new e(n)}),N=function(n){return n.value},E=function(n){return F(n)?N(n):void 0},x=function(n,r){return function(e){return t.any(F,n,e)?b(t.modify(n,r,e)):e}},I=t.rewrite(x(t.elems,function(n){return F(n)?N(n):null})),z=t.rewrite(x(t.elems,E)),M=t.rewrite(x(t.values,E)),q=function(n){return F(n)?i(u(N(n))):n},P=function(n,r,t){return function(){var e=arguments.length,u=n;if(e)for(u=r(arguments[--e],u);e;)u=t(arguments[--e],u);return u}},R=r.id(function(n){if(r.isFunction(n))return c(n)<3?un(n):n;var t=n[1];return r.isFunction(t)?on(t,n[0]):cn(t,n[0])}),V=function(n,r){return t.ifElse(n,W(r),G)},W=l(t.toFunction,t.modify(t.elems,R)),_=function(n){var e=n.less,u=n.rest;return u=R(u),function(){for(var n=[],i=arguments.length,o=0;o<i;++o)n.push(R(arguments[o]));return V(e?r.isArray:y(r.isArray,l(f(i),c)),[j,I,e?function(n,r,e,u){var o=c(n);return o<i?((n=n.slice()).length=i,e.map(function(n){return t.any(F,t.elems,n)?n:n.slice(0,o)},t.elems(n,r,e,u))):t.elems(n,r,e,u)}:t.elems,O,t.choose(function(r,t){return n[t]||u})])}},k=function(n,r,t){return X({Monad:n,onAccept:r,onReject:t})},C=A,J=function(n,r){return function(t,e){try{return n(t,e)}catch(n){return C=n,r}}},L=t.zero,S=function(n){return function(r,t,e,u){return u(n,t)}},B=function(n){return function(r,t,e,u){return e.chain(function(n){return u(n,t)},n(r,t))}},D=l(t.setOp,b),G=t.modifyOp(b),H=S(void 0),K=r.always(G),Q=function(n,r,t){return function(e,u){return function(i,c,f,a){return f.chain(function(n){return n?r(i,c,f,a):void 0!==n||C===A?t(e,u)(i,c,f,a):o(f,i)},n(e,u))}}},T=function(n){return r.curryN(2,function(r){return r=R(r),function(t){return t=R(t),n(r,t)}})},U=function(n){return function(r){return 3===c(r)?[r[0],sn(fn(r[1],r[2]),n)]:r}},X=r.curryN(3,function(n){var e=n.Monad||t.Identity,u=n.onAccept||r.id,o=n.onReject||i,c=function(n){return F(n)?o(N(n)):u(n)};return function(n){return n=R(n),function(u){return e.chain(c,t.traverse(e,r.id,n,u))}}}),Y=k(0,r.always(!0),r.always(!1)),Z=k(0,function(n){},r.id),$=k(),nn=k(m,r.always(v(!0)),r.always(v(!1))),rn=k(m,r.always(v()),v),tn=k(m,0,l(i,u)),en=k(m,v,l(p,u)),un=function(n){return n=J(n),function(r,t,e,u){return e.chain(function(n){return n?e.of(r):o(e,r)},n(r,t))}},on=r.curry(function(n,r){return r=R(r),function(t,e,u,i){return u.chain(function(r){return F(r)?u.map(b,n(t,N(r),e)):u.of(r)},r(t,e,u,i))}}),cn=r.curry(function(n,r){return W([t.rewrite(function(r){return F(r)?b(n):r}),r])}),fn=r.curryN(2,function(n){return l(sn(n),B)}),an=r.curryN(2,function(n){return l(sn(n),S)}),sn=T(function(n,r){return function(t,e,u,i){return u.chain(function(n){return F(n)?u.of(n):r(n,e,u,i)},n(t,e,u,i))}}),ln=P(L,R,sn),yn=T(function(n,r){return function(t,e,u,i){return u.chain(function(n){return F(n)?r(t,e,u,i):u.of(n)},n(t,e,u,i))}}),dn=P(G,R,yn),pn=_({less:!0,rest:L}),vn=_({less:!1,rest:G}),hn=r.curry(function(n,e){return n=R(n),function(o,c,f,a){return f.of(r.isFunction(o)?function(){for(var c=arguments.length,a=Array(c),s=0;s<c;s++)a[s]=arguments[s];return f.chain(function(n){return F(n)?i(u(N(n))):f.chain(function(u){return f.map(q,t.traverse(f,r.id,R(e.apply(null,n)),u))},o.apply(null,n))},t.traverse(f,r.id,n,a))}:b(o))}}),mn=r.curry(function(n,t){return hn(n,r.always(t))}),An=r.curry(function(n,r){return V(s,[t.setter(function(r,e){return F(r)?b(t.set(n,function(n,r,e){return void 0!==(r=t.get(n,r))?r:t.get(n,e)}(n,N(r),e),N(r))):r}),r])}),wn=r.curry(function(n,r){return V(s,[M,t.branchOr(R(n),t.modify(t.values,R,r))])}),gn=wn(G),jn=P(G,r.id(function(n,r){return 1===c(n)?n[0]:On(n[0],n[1],r)}),r.id(function(n,r){return On(n[0],n[1],r)})),On=r.curry(function(n,r,t){return n=J(n),r=R(r),t=R(t),function(e,u,i,c){return i.chain(function(n){return n?r(e,u,i,c):void 0!==n||C===A?t(e,u,i,c):o(i,e)},n(e,u))}}),Fn=r.id(function(n){n=t.toFunction(n);for(var e=arguments.length,u=K;--e;){var i=arguments[e];u=1!==c(i)?Q(J(i[0]),R(i[1]),u):r.always(R(i[0]))}return function(r,e,i,o){return n(r,e,t.Constant,u)(r,e,i,o)}}),bn=l(t.lazy,l(R)),Nn=r.id(function(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++)r[t]=arguments[t];return bn(function(n){return dn.apply(null,r.map(function(r){return 2===c(r)?sn(fn(r[0],r[1]),n):r[0]}))})}),En=r.id(function(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++)r[t]=arguments[t];return bn(function(n){return jn.apply(null,r.map(U(n)))})}),xn=r.id(function(n){for(var r=arguments.length,t=Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];return bn(function(r){return Fn.apply(null,[n].concat(t.map(U(r))))})});n.accept=L,n.acceptAs=S,n.acceptWith=B,n.rejectWith=function(n){return function(r,t,e,u){return e.map(b,n(r,t))}},n.rejectAs=D,n.reject=G,n.remove=H,n.run=X,n.accepts=Y,n.errors=Z,n.validate=$,n.acceptsAsync=nn,n.errorsAsync=rn,n.tryValidateAsyncNow=tn,n.validateAsync=en,n.where=un,n.modifyError=on,n.setError=cn,n.modifyAfter=fn,n.setAfter=an,n.removeAfter=function(n){return sn(n,H)},n.both=sn,n.and=ln,n.not=function(n){return W([t.setter(function(n,r){return F(n)?r:b(r)}),n])},n.either=yn,n.or=dn,n.arrayId=function(n){return V(r.isArray,[z,t.elems,n])},n.arrayIx=function(n){return V(r.isArray,[I,t.elems,n])},n.args=pn,n.tuple=vn,n.dependentFn=hn,n.freeFn=mn,n.keep=An,n.optional=function(n){return W([t.optional,n])},n.propsOr=wn,n.props=gn,n.choose=function(n){return n=J(n),function(r,t,e,u){return e.chain(function(n){return n?R(n)(r,t,e,u):o(e,r)},n(r,t))}},n.cases=jn,n.ifElse=On,n.casesOf=Fn,n.lazy=bn,n.promote=Nn,n.upgrades=En,n.upgradesOf=xn,Object.defineProperty(n,"__esModule",{value:!0})});
